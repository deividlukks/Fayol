# ==========================================
# FAYOL - Sistema de Gestão Financeira Pessoal
# ==========================================
# INSTRUÇÕES:
# 1. Copie este arquivo para .env: cp .env.example .env
# 2. Preencha os valores de acordo com seu ambiente
# 3. NUNCA commite o arquivo .env no git
# 4. Para produção, use variáveis de ambiente seguras
# ==========================================

# ==========================================
# GERAL & AMBIENTE
# ==========================================
NODE_ENV=development
# Timezone do servidor (padrão: América/São Paulo)
TZ=America/Sao_Paulo
# Nível de log: debug, info, warn, error
LOG_LEVEL=info

# ==========================================
# BANCO DE DADOS (PostgreSQL)
# ==========================================
# Credenciais do PostgreSQL
POSTGRES_USER=fayol_admin
POSTGRES_PASSWORD=fayol_secure_password_123!
POSTGRES_DB=fayol_db
POSTGRES_PORT=5432

# URL de Conexão do Prisma
# Formato: postgresql://USER:PASSWORD@HOST:PORT/DATABASE?schema=SCHEMA
# Para Docker (interno): use 'postgres' como host
# Para conexão externa: use 'localhost' como host
DATABASE_URL="postgresql://fayol_admin:fayol_secure_password_123!@localhost:5432/fayol_db?schema=public"

# Connection Pool Settings (Prisma 7 - gerenciado pelo driver pg)
# IMPORTANTE: No Prisma 7, o pooling é controlado pelo driver pg, não pelo Prisma Client
# Máximo de conexões simultâneas no pool (padrão: 10)
DATABASE_POOL_MAX=10
# Tempo antes de fechar conexão inativa em milissegundos (padrão: 10000ms = 10s)
DATABASE_IDLE_TIMEOUT=10000
# Timeout para estabelecer nova conexão em milissegundos (0 = sem timeout, padrão Prisma 7)
DATABASE_CONNECTION_TIMEOUT=0

# ==========================================
# CACHE & FILAS (Redis)
# ==========================================
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=redis_secure_pass_123!
# TTL padrão do cache (em segundos)
CACHE_TTL=3600

# ==========================================
# API BACKEND (NestJS)
# ==========================================
# Porta do servidor backend
PORT_BACKEND=3333
# Prefixo global das rotas da API (ex: /api/users)
API_GLOBAL_PREFIX=api

# JWT Authentication
JWT_SECRET=super_secret_jwt_key_fayol_2025_CHANGE_THIS_IN_PRODUCTION
JWT_EXPIRATION=1d
REFRESH_TOKEN_SECRET=super_secret_refresh_key_CHANGE_THIS_IN_PRODUCTION
REFRESH_TOKEN_EXPIRATION=7d

# Two-Factor Authentication Encryption
# IMPORTANTE: Use uma chave forte de 128 caracteres
TWO_FACTOR_ENCRYPTION_KEY=your_128_character_encryption_key_here_change_me

# Rate Limiting
THROTTLE_TTL=60
THROTTLE_LIMIT=100

# CORS Origins (separados por vírgula)
CORS_ORIGINS=http://localhost:3000,http://localhost:3001,http://localhost:19006

# URLs dos Apps (para CORS)
FRONTEND_URL=http://localhost:3000
ADMIN_URL=http://localhost:3001

# Cookie Domain (use .fayol.app em produção para compartilhar entre subdomínios)
COOKIE_DOMAIN=localhost

# URLs dos Microsserviços
# Para Docker interno: use nome do serviço (python-ai, bi-reports)
# Para desenvolvimento local: use localhost
AI_SERVICE_URL=http://python-ai:8000
REPORTS_SERVICE_URL=http://bi-reports:8001

# ==========================================
# FRONTEND WEB (Next.js)
# ==========================================
PORT_WEB=3000
# URL pública da API (acessível pelo navegador)
NEXT_PUBLIC_API_URL=http://localhost:3333/api
# URL do site (para geração de links)
NEXT_PUBLIC_SITE_URL=http://localhost:3000

# Analytics (opcional)
# NEXT_PUBLIC_GA_ID=G-XXXXXXXXXX

# ==========================================
# ADMIN PANEL (Next.js)
# ==========================================
PORT_ADMIN=3001
# URL pública da API para o admin panel
NEXT_PUBLIC_ADMIN_API_URL=http://localhost:3333/api
# URL do admin panel
NEXT_PUBLIC_ADMIN_SITE_URL=http://admin.localhost:3001

# ==========================================
# MOBILE (React Native / Expo)
# ==========================================
# URL da API para o app mobile
# Use seu IP local para testar em dispositivo físico
# Exemplo: http://192.168.1.100:3333/api
EXPO_PUBLIC_API_URL=http://localhost:3333/api

# ==========================================
# MICROSSERVIÇOS PYTHON (AI & BI)
# ==========================================
PORT_AI=8000
PORT_BI_REPORTS=8001
PYTHON_ENV=development

# ML Model Settings
AI_MODEL_PATH=/app/data/models
AI_CONFIDENCE_THRESHOLD=0.7

# ==========================================
# TELEGRAM BOT
# ==========================================
# Token obtido via @BotFather
TELEGRAM_BOT_TOKEN=123456789:ABCdefGHIjklMNOpqrsTUVwxyz
# Webhook domain (para produção)
TELEGRAM_WEBHOOK_DOMAIN=https://api.fayol.app/webhook
# Modo de operação: polling ou webhook
TELEGRAM_MODE=polling

# ==========================================
# ADMINISTRAÇÃO (PGAdmin)
# ==========================================
PGADMIN_EMAIL=admin@fayol.app
PGADMIN_PASSWORD=admin_pg_secure_CHANGE_THIS
PGADMIN_PORT=5050

# ==========================================
# OBSERVABILIDADE & MONITORAMENTO
# ==========================================
# Sentry (Error Tracking)
SENTRY_DSN=https://examplePublicKey@o0.ingest.sentry.io/0
SENTRY_ENVIRONMENT=development
SENTRY_TRACES_SAMPLE_RATE=1.0

# OpenTelemetry (opcional)
OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4318
OTEL_SERVICE_NAME=fayol-backend

# ==========================================
# INTEGRAÇÕES EXTERNAS
# ==========================================

# --------- PAGAMENTOS ---------
# Stripe (https://dashboard.stripe.com/apikeys)
STRIPE_SECRET_KEY=sk_test_51...
STRIPE_PUBLISHABLE_KEY=pk_test_51...
STRIPE_WEBHOOK_SECRET=whsec_...

# --------- OPEN BANKING ---------
# Pluggy (https://dashboard.pluggy.ai/)
PLUGGY_CLIENT_ID=your_pluggy_client_id
PLUGGY_CLIENT_SECRET=your_pluggy_client_secret
PLUGGY_ENVIRONMENT=sandbox

# Belvo (alternativa)
# BELVO_SECRET_ID=...
# BELVO_SECRET_PASSWORD=...
# BELVO_ENVIRONMENT=sandbox

# --------- MARKET DATA ---------
# Alpha Vantage (https://www.alphavantage.co/support/#api-key)
ALPHA_VANTAGE_API_KEY=your_alpha_vantage_api_key

# Yahoo Finance (sem API key necessária, mas respeite rate limits)
YAHOO_FINANCE_ENABLED=true

# --------- EMAIL ---------
# Resend (https://resend.com/api-keys)
RESEND_API_KEY=re_...
MAIL_FROM_ADDRESS=noreply@fayol.app
MAIL_FROM_NAME=Fayol

# SendGrid (alternativa)
# SENDGRID_API_KEY=SG...
# SENDGRID_FROM_EMAIL=noreply@fayol.app

# --------- ARMAZENAMENTO DE ARQUIVOS ---------
# AWS S3 (para uploads de anexos)
# AWS_ACCESS_KEY_ID=...
# AWS_SECRET_ACCESS_KEY=...
# AWS_S3_BUCKET=fayol-attachments
# AWS_S3_REGION=us-east-1

# Cloudflare R2 (alternativa compatível com S3)
# R2_ACCESS_KEY_ID=...
# R2_SECRET_ACCESS_KEY=...
# R2_BUCKET=fayol-attachments
# R2_ENDPOINT=https://...r2.cloudflarestorage.com

# --------- NOTIFICAÇÕES PUSH ---------
# Firebase Cloud Messaging (para mobile)
# FIREBASE_PROJECT_ID=...
# FIREBASE_PRIVATE_KEY=...
# FIREBASE_CLIENT_EMAIL=...

# OneSignal (alternativa)
# ONESIGNAL_APP_ID=...
# ONESIGNAL_API_KEY=...

# ==========================================
# SEGURANÇA & COMPLIANCE
# ==========================================
# LGPD/GDPR Settings
DATA_RETENTION_DAYS=365
CONSENT_VERSION=1.0

# Encryption Keys (para dados sensíveis)
# IMPORTANTE: Use chaves fortes e únicas em produção
ENCRYPTION_KEY=your_32_character_encryption_key_here_change_me_in_production
ENCRYPTION_ALGORITHM=aes-256-gcm

# Session Security
SESSION_SECRET=your_session_secret_change_this_in_production
COOKIE_SECURE=false
# Em produção, defina como true

# ==========================================
# RECURSOS OPCIONAIS
# ==========================================
# Feature Flags
FEATURE_AI_CATEGORIZATION=true
FEATURE_INVESTMENT_TRACKING=true
FEATURE_OPEN_BANKING=false
FEATURE_TWO_FACTOR_AUTH=true
FEATURE_TELEGRAM_BOT=false

# Limites de uso
MAX_ACCOUNTS_PER_USER=10
MAX_TRANSACTIONS_PER_IMPORT=1000
MAX_FILE_SIZE_MB=10

# ==========================================
# TESTES & DESENVOLVIMENTO
# ==========================================
# URL do banco de testes (separado do desenvolvimento)
# TEST_DATABASE_URL="postgresql://fayol_admin:fayol_secure_password_123!@localhost:5432/fayol_test?schema=public"

# Bypass de autenticação em testes (NUNCA em produção)
# TEST_AUTH_BYPASS=false

# Debug mode
DEBUG=false

# ==========================================
# NOTAS IMPORTANTES
# ==========================================
# 1. Substitua todos os valores de exemplo por valores reais
# 2. Em produção, use um gerenciador de secrets (AWS Secrets Manager, HashiCorp Vault, etc.)
# 3. Gere chaves fortes: openssl rand -base64 32
# 4. Mantenha este arquivo atualizado quando adicionar novas variáveis
# 5. Para Docker, use o host 'postgres' e 'redis' no DATABASE_URL e REDIS_HOST
# 6. Para desenvolvimento local (sem Docker), use 'localhost'
# 7. PRISMA 7: Connection pooling agora é gerenciado pelo driver pg (não pelo Prisma Client)
#    - Use DATABASE_POOL_MAX ao invés de DATABASE_POOL_SIZE
#    - DATABASE_IDLE_TIMEOUT controla quando conexões inativas são fechadas
#    - DATABASE_CONNECTION_TIMEOUT com valor 0 = sem timeout (novo padrão do Prisma 7)